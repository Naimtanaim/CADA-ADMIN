<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>託運簽單</title>

<style>
body {
  margin: 0;
  font-family: "PMingLiU","MingLiU","Microsoft JhengHei",serif;
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* ================= FORM ================= */
form {
  width: 30%;
  padding: 20px;
  background: #f5f5f5;
  overflow-y: auto;
  box-sizing: border-box;
}

form h3 { margin-top: 0; }

.form-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  flex-wrap: wrap;
}

form input {
  font-size: 14px;
  padding: 4px;
  width: 200px;
}

/* ================= PREVIEW ================= */
.preview-container {
  width: 70%;
  padding: 20px;
  background: #e0e0e0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
}

.paper {
  position: relative;
  width: 210mm;
  height: 140mm;
  background: url("bg.jpg") no-repeat;
  background-size: 210mm 250mm;
  box-shadow: 0 0 5px rgba(0,0,0,.3);
}

/* ===== FIELD UMUM (❗ nowrap DIHAPUS) ===== */
.field {
  position: absolute;
  font-size: 15px;
}

/* posisi */
.date    { top: 19mm; left: 128mm; }
.customer{ top: 29mm; left: 29mm; }
.start_end{ top: 40mm; left: 25mm; }
.delivery{ top: 49mm; left: 18mm; }
.qty     { top: 90mm; left: 28mm; }
.board   { top: 90mm; left: 43mm; }
.weight  { top: 90mm; left: 68mm; }
.cbm     { top: 90mm; left: 100mm; }
.basic   { top: 100mm; left: 30mm; }
.extra   { top: 100mm; left: 68mm; }
.total   { top: 110mm; left: 30mm; font-weight: bold; }

/* ===== DELIVERY FIX ===== */
.field.delivery {
  display: flex;
  flex-direction: column;
  white-space: normal;
  max-width: 160mm;
}

.delivery-item {
  white-space: pre-line;
}

.item-1 { margin-bottom: 12px; }
.item-2 { margin-bottom: 15px; }
.item-3 { margin-bottom: 17px; }
.item-4 { margin-bottom: 10px; }

.delivery-item:last-child {
  margin-bottom: 0;
}

/* ================= PRINT ================= */
@media print {
  body { display: block; }
  form { display: none; }
  .preview-container { width: 100%; padding: 0; background: none; }
  .paper { box-shadow: none; }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<form id="form">
<h3>Isi Data 託運簽單</h3>

<div class="form-row">
  <label>日期:</label>
  <input id="year">年
  <input id="month">月
  <input id="day">日
</div>

<div class="form-row">
  <label>顧客名稱:</label>
  <input id="customer">
</div>

<div class="form-row"><label>配送內容:</label><input id="delivery1"></div>
<div class="form-row"><input id="delivery2"></div>
<div class="form-row"><input id="delivery3"></div>
<div class="form-row"><input id="delivery4"></div>

<div class="form-row">
  <label>板數:</label><input id="qty">
  <label>件數:</label><input id="board">
</div>

<div class="form-row">
  <label>重量:</label><input id="weight">
  <label>才數:</label><input id="cbm">
</div>

<div class="form-row">
  <label>基本:</label><input id="basic">
  <label>額外:</label><input id="extra">
  <label>總計:</label><input id="total">
</div>

<button type="button" onclick="updatePaper()">更新</button>
<button type="button" onclick="window.print()">列印</button>
</form>

<div class="preview-container">
<div class="paper">
  <div class="field date" id="f_date"></div>
  <div class="field customer" id="f_customer"></div>
  <div class="field delivery" id="f_delivery"></div>
  <div class="field qty" id="f_qty"></div>
  <div class="field board" id="f_board"></div>
  <div class="field weight" id="f_weight"></div>
  <div class="field cbm" id="f_cbm"></div>
  <div class="field basic" id="f_basic"></div>
  <div class="field extra" id="f_extra"></div>
  <div class="field total" id="f_total"></div>
</div>
</div>

<script>
function num(v){ return parseFloat(v)||0; }

function updatePaper(){
  f_date.innerText = `${year.value}　　${month.value}　　${day.value}`;
  f_customer.innerText = customer.value;

  const deliveries = [
    delivery1.value,
    delivery2.value,
    delivery3.value,
    delivery4.value
  ];

  f_delivery.innerHTML = "";
  deliveries.forEach((val,i)=>{
    if(val.trim()){
      const d = document.createElement("div");
      d.className = `delivery-item item-${i+1}`;
      d.textContent = val;
      f_delivery.appendChild(d);
    }
  });

  f_qty.innerText = qty.value;
  f_board.innerText = board.value;
  f_weight.innerText = weight.value;
  f_cbm.innerText = cbm.value;
  f_basic.innerText = basic.value;
  f_extra.innerText = extra.value;
  f_total.innerText = (num(basic.value)+num(extra.value)).toFixed(0);
}

document.querySelectorAll("input").forEach(i=>{
  i.addEventListener("input", updatePaper);
});
</script>

</body>
</html>
